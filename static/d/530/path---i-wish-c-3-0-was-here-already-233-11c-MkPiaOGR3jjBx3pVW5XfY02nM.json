{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog","author":"Kyle Mathews"}},"markdownRemark":{"id":"42c30b39-1fc9-512b-bbb5-40c3c84200ca","html":"<p>I was reading <a href=\"http://haacked.com/archive/2007/09/09/ihttpcontext-and-other-interfaces-for-your-duck-typing-benefit.aspx\" title=\"IHttpContext And Other Interfaces For Your Duck Typing Benefit\">IHttpContext And Other Interfaces For Your Duck Typing Benefit</a> over on <a href=\"http://www.haacked.com\">Haacked</a>. It reminded my of something I did Thursday, which made me wish that .Net 3.5 was already usable.</p>\n<p>I actually finally convinced my boss to let me try to automate at least some of the testing. So first order of business, change our the SQL installer program we use to allow it run without user interaction. </p>\n<p>After a good amount of refactoring of the monolithic control function, I get that part working. It can now do everything it needs to do by passing in all the stuff I need on the command line. After answering some several questions from the junior developers, several of which they answered them selves during the course of the conversation, I start to move onto making it into something useful.</p>\n<p>I decide to make a simple API that I could use to inside of programs, so I can make a quick proof of concept for my boss who is skeptical that it would be feasible to make tests for the SQL (business logic). Something along the lines of here are your options, start and let me know how it went. That’s when the fun started, its a single executable file and “needs” to stay that way (which I agree with overall). After my momentary amnesia about not being able to reference exe files, I decide that I am going to use reflection.</p>\n<p>My first attempt went something like: </p> </p>\n<blockquote>\n<pre class=\"csharpcode\">//The installer has a start method\ninterface IInstaller{void Start();} \npublic IInstaller Bind()\n{\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">Assembly assembly = Assembly.LoadFile(&quot;&amp;lt;Path&amp;gt;&quot;);\nType type = assembly.GetType(&quot;namespace.frm&quot;);\nConstructorInfo constructorInfo = type.GetConstructor(new Type[]{});\nIInstaller installer = (IInstaller)constructorInfo.Invoke(new object[]{});</code></pre>\n      </div>\n<p>}</p>\n</pre>\n<p>That didnt work so well, since while namespace.frm object had a Start method, it wasn’t from that interface, and shared no assemblies in common that I could use an interface from. In the end I decided to make a wrapper class that would take the object and make use a delegate to keep a reference to the Start method.</p>\n<p>Something close to this: </p>\n<blockquote>\n<pre class=\"csharpcode\">public interface IInstaller{void Start();}\npublic class InstallerWrapper:IInstaller\n{\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\">\n      <pre class=\"language-text\"><code class=\"language-text\">private delegate void StartMethod();\nStartMethod startDelegate;\nobject _installer;\npublic InstallerWrapper(object installer)\n{\n\t_installer = installer;\n\tstartDelegate = (StartMethod)Delegate.CreateDelegate(typeof(StartMethod), installer, &quot;Start&quot;);\n}\npublic void Start()\n{\n\tstartDelegate();\t\n}\t</code></pre>\n      </div>\n<p>}\npublic IInstaller Bind()\n{\nAssembly assembly = Assembly.LoadFile(”&#x3C;Path>”);\nType type = assembly.GetType(“namespace.frm”);\nConstructorInfo constructorInfo = type.GetConstructor(new Type[]{});\nreturn new InstallerWrapper(constructorInfo.Invoke(new object[]{}));\n}</p>\n</pre>\n<p>Thinking about what I have read about the implementation of it in C# 3.0 I would likely have needed to do it this way anyways, since atleast from what I have read it is a compile time feature. Haven’t tested it yet on my VS 2008 beta VM yet though, so I could be wrong. </p>\n<p>Oh, and please forgive the formatting of the code, haven’t done it much yet.</p>\n<img src=\"http://seanlynch.io/aggbug/29.aspx\" width=\"1\" height=\"1\">\n<p><span class=\"tve-leads-two-step-trigger tl-2step-trigger-0\"></span><span class=\"tve-leads-two-step-trigger tl-2step-trigger-0\"></span></p>","frontmatter":{"title":"I wish C# 3.0 was here already","date":"September 10, 2007"}}},"pageContext":{"slug":"/i-wish-c-3-0-was-here-already/","previous":null,"next":{"fields":{"slug":"/committing-to-subtext-blogdomain-aliases/"},"frontmatter":{"title":"Committing to subtext, blog/domain aliases"}}}}